<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Márkaszemélyiség kvíz</title>

<link rel="icon" type="image/png" href="https://cdn.prod.website-files.com/68c02379dfdad28c3492d8c5/69370eeaa7ca9b8de5ae2d6f_favion-bb.png">
<link rel="stylesheet" href="https://use.typekit.net/bja6xtr.css">

<style>
  * { box-sizing: border-box; }

  :root {
    --bg-body:#242427;
    --bg-card:#ffffff;
    --border-soft:#e3e3e3;
    --text-main:#111111;
    --accent:#111111;
    --accent-soft:#f5f5f7;
  }

  body { 
    margin:0; 
    padding:16px; 
    background:var(--bg-body); 
    color:var(--text-main);
    font-family: "atyp-bl-variable", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    font-variation-settings: "opsz" 6, "ital" 0, "wght" 320;
  }

  .quiz { 
    max-width:520px; 
    margin:0 auto; 
    background:var(--bg-card); 
    padding:24px 20px 20px; 
    border-radius:18px; 
    box-shadow:0 18px 45px rgba(0,0,0,0.25);
    position:relative;
  }

  .quiz-header {
    margin-bottom:18px;
  }

  .quiz-title {
    text-align:center; 
    font-size:24px; 
    margin:0 0 4px;
    letter-spacing:0.03em;
    font-variation-settings:"opsz" 6, "ital" 0, "wght" 620;
  }

  .quiz-sub {
    text-align:center;
    font-size:13px;
    opacity:0.7;
    margin:0;
  }

  .progress-wrap {
    display:none;
    margin-bottom:16px;
  }

  .progress-label {
    font-size:12px;
    text-transform:uppercase;
    letter-spacing:0.08em;
    margin-bottom:6px;
    font-variation-settings:"opsz" 6, "ital" 0, "wght" 550;
  }

  .progress-bar {
    width:100%;
    height:4px;
    border-radius:999px;
    background:var(--accent-soft);
    overflow:hidden;
  }

  .progress-bar-inner {
    height:100%;
    width:0%;
    background:var(--accent);
    transition:width 0.25s ease;
  }

  .step { 
    display:none; 
  }
  .step.active { 
    display:block; 
  }

  h2 { 
    font-size:18px; 
    margin:0 0 10px; 
    font-variation-settings:"opsz" 6, "ital" 0, "wght" 580;
  }

  p {
    font-size:14px;
    line-height:1.5;
    margin:0 0 14px;
  }

  .options { 
    display:grid; 
    gap:14px; 
    grid-template-columns:1fr; 
  }

  @media (min-width:600px) {
    .options {
      grid-template-columns:1fr 1fr;
    }
  }

  .option { 
    border:2px solid var(--border-soft); 
    border-radius:16px; 
    overflow:hidden; 
    cursor:pointer; 
    transition:
      transform 0.15s ease, 
      box-shadow 0.15s ease, 
      border-color 0.15s ease,
      background 0.15s ease;
    background:var(--accent-soft); 
  }

  .option img { 
    width:100%; 
    height:200px; 
    object-fit:cover; 
    display:block; 
  }

  .option.selected { 
    border-color:var(--accent); 
    box-shadow:0 0 0 2px var(--accent); 
    transform:translateY(-2px); 
    background:#ffffff;
  }

  button { 
    width:100%; 
    margin-top:20px; 
    padding:13px; 
    font-size:15px; 
    border:none; 
    border-radius:999px; 
    background:var(--accent); 
    color:white; 
    cursor:pointer;
    transition:background 0.15s ease, transform 0.1s ease, box-shadow 0.1s ease;
    font-family: "atyp-bl-variable", system-ui, sans-serif;
    font-variation-settings:"opsz" 6, "ital" 0, "wght" 580;
  }

  button:hover:not(:disabled) { 
    background:#000; 
    box-shadow:0 8px 20px rgba(0,0,0,0.22);
    transform:translateY(-1px);
  }

  button:active:not(:disabled) {
    transform:translateY(0);
    box-shadow:none;
  }

  button:disabled {
    opacity:0.7;
    cursor:default;
    box-shadow:none;
  }

  .result-list { 
    list-style:none; 
    padding:0; 
    margin:0;
  }

  .result-list li { 
    padding:5px 0; 
    font-size:15px; 
    display:flex;
    justify-content:space-between;
  }

  .result-list li strong {
    font-variation-settings:"opsz" 6, "ital" 0, "wght" 600;
  }

  input { 
    width:100%; 
    padding:12px; 
    margin-bottom:10px; 
    font-size:14px; 
    border-radius:10px; 
    border:1px solid #ccc;
    font-family: "atyp-bl-variable", system-ui, sans-serif;
    font-variation-settings:"opsz" 6, "ital" 0, "wght" 360;
  }

  input::placeholder {
    opacity:0.6;
  }

  .send-status {
    margin-top:8px;
    font-size:13px;
    color:#555;
    text-align:center;
    min-height:18px;
  }

  .spinner {
    display:inline-block;
    width:13px;
    height:13px;
    border:2px solid rgba(0,0,0,0.15);
    border-top-color:#000;
    border-radius:50%;
    animation:spin 0.7s linear infinite;
    vertical-align:middle;
    margin-right:6px;
  }

  @keyframes spin {
    to { transform:rotate(360deg); }
  }
</style>
</head>
<body>
<div class="quiz">
  <div class="quiz-header" id="quizHeader">
    <h1 class="quiz-title">Márkaszemélyiség kvíz</h1>
    <p class="quiz-sub">8 archetípus, 1 márkaszemélyiség.</p>
  </div>

  <div class="progress-wrap" id="progressWrap">
    <div class="progress-label" id="progressLabel">1 / 13</div>
    <div class="progress-bar">
      <div class="progress-bar-inner" id="progressBar"></div>
    </div>
  </div>

  <div id="steps"></div>
</div>

<script>
const archetypes = { Mars:0, Mercurius:0, Jupiter:0, Apollo:0, Terra:0, Ceres:0, Juno:0, Venus:0 };
const stepsEl = document.getElementById("steps");
const progressWrap = document.getElementById("progressWrap");
const progressBar = document.getElementById("progressBar");
const progressLabel = document.getElementById("progressLabel");
const quizHeader = document.getElementById("quizHeader");

const textArchetypesOrder = ["Mars","Mercurius","Jupiter","Apollo","Terra","Ceres","Juno","Venus"];

// kezdő step
stepsEl.innerHTML += `
<div class="step active">
  <h2>Üdvözlünk a Márkaszemélyiség kvízben!</h2>
  <p>Ez a kvíz segít feltérképezni, milyen archetípus jellemzi a céget. Kérjük, add meg az email címed, hogy az eredményeket el tudjuk küldeni.</p>
  <input type="email" placeholder="Email címed" id="startEmail">
  <input type="text" placeholder="Név" id="startName">
  <button onclick="startQuiz()">Kezdhetjük</button>
</div>
`;

// INNENTŐL minden step 8 opciót vár (Mars–Mercurius–Jupiter–Apollo–Terra–Ceres–Juno–Venus)
const stepsData = [
  { q:"Vendégváró tér", type:"image", options:[
    "https://picsum.photos/600/400?random=1",
    "https://picsum.photos/600/400?random=2",
    "https://picsum.photos/600/400?random=3",
    "https://picsum.photos/600/400?random=4",
    "https://picsum.photos/600/400?random=5",
    "https://picsum.photos/600/400?random=6",
    "https://picsum.photos/600/400?random=7",
    "https://picsum.photos/600/400?random=8"
  ]},
  // IDE RAKHATOD A TÖBBI 7–8 LÉPÉST UGYANEZZEL A 8-OPCIÓS SÉMÁVAL
  { q:"Csak a képzelet szab nekünk határt", type:"text", options:[
    "Ez a jó irány, és mi meg is valósítjuk.",
    "A tudás hatalom",
    "A kompromisszumkészség erény, nem gyengeség",
    "Egyedül kicsik vagyunk, együtt nagyot alkotunk",
    "A világ a mi játszóterünk",
    "A változásokból rugalmasan és optimistán kihozzuk a legjobbat.",
    "Stabil, földelt alapokra építkezünk.",
    "A gondoskodás és biztonság az első."
  ]},
  // … folytathatod a többi kérdéssel, mindegyik options tömb 8 elemmel
];

// archetype hozzárendelés MINDEN kérdésnél
stepsData.forEach((s, i) => {
  const archetypeOrder = textArchetypesOrder; // minden stepnél ugyanaz a sorrend
  let optionsHtml = s.options.map((opt, idx) => {
    const archetype = archetypeOrder[idx];
    if(s.type==="image"){
      return `<div class="option" data-archetype="${archetype}"><img src="${opt}" alt=""></div>`;
    } else {
      return `<div class="option" data-archetype="${archetype}">${opt}</div>`;
    }
  }).join("");
  stepsEl.innerHTML += `
    <div class="step">
      <h2>${i+1}. ${s.q}</h2>
      <div class="options">${optionsHtml}</div>
      <button onclick="nextStep()">Tovább</button>
    </div>
  `;
});

// végső step összevontan – eredmény + küldés
stepsEl.innerHTML += `
<div class="step">
  <h2>Eredményed</h2>
  <ul class="result-list" id="result"></ul>
  <button id="sendBtn" onclick="sendResults()">Eredmény mentése</button>
  <div class="send-status" id="sendStatus"></div>
</div>
`;

let current = 0;
const steps = document.querySelectorAll(".step");
const totalQuestionSteps = steps.length - 2; // az első (intro) + utolsó (eredmény) nélkül

function updateProgress() {
  // Kérdésszám: az aktuális step indexe - 1 (mert 0 az intro, utolsó az eredmény)
  const questionIndex = Math.min(Math.max(current - 1, 0), totalQuestionSteps);
  const total = totalQuestionSteps;
  if (total <= 0) return;

  progressLabel.textContent = `${questionIndex + 1} / ${total}`;
  const percent = ((questionIndex) / total) * 100;
  progressBar.style.width = `${percent}%`;
}

// start quiz
function startQuiz(){
  const email = document.getElementById("startEmail").value.trim();
  const name = document.getElementById("startName").value.trim();
  if(!email || !name) { 
    alert("Kérlek add meg az email címed és neved!"); 
    return; 
  }
  steps[0].classList.remove("active");
  current++;
  steps[current].classList.add("active");

  // címsor helyett progress bar
  quizHeader.style.display = "none";
  progressWrap.style.display = "block";
  updateProgress();
}

// kiválasztás
document.addEventListener("click", e=>{
  const option = e.target.closest(".option");
  if(!option) return;
  option.parentElement.querySelectorAll(".option").forEach(o=>o.classList.remove("selected"));
  option.classList.add("selected");
});

// lépés váltás – utolsó kérdés után eredmény + küldés gomb
function nextStep(){
  const selected = steps[current].querySelector(".option.selected");
  if(!selected) { 
    alert("Válassz egy opciót!"); 
    return; 
  }
  archetypes[selected.dataset.archetype]++;
  steps[current].classList.remove("active");
  current++;

  if(current === steps.length - 1) {
    showResult();
  }

  steps[current].classList.add("active");
  updateProgress();
  window.scrollTo({top:0, behavior:"smooth"});
}

// eredmény megjelenítés
function showResult(){
  const total = Object.values(archetypes).reduce((a,b)=>a+b,0) || 1;
  let html="";
  for(const key of textArchetypesOrder){
    const v = archetypes[key] || 0;
    html += `<li><strong>${key}</strong><span>${Math.round(v/total*100)}%</span></li>`;
  }
  document.getElementById("result").innerHTML=html;
}

// mentés Google Sheet-be – Vercel proxyval, egyszeri kattintás + loading
let isSending = false;

function sendResults(){
  if (isSending) return;

  const email = document.getElementById("startEmail").value.trim();
  const name = document.getElementById("startName").value.trim();
  if(!email || !name){ 
    alert("Hiányzó név vagy email. Lépj vissza az elejére és töltsd ki."); 
    return; 
  }

  const btn = document.getElementById("sendBtn");
  const statusEl = document.getElementById("sendStatus");

  isSending = true;
  btn.disabled = true;
  btn.textContent = "Küldés folyamatban...";
  statusEl.innerHTML = '<span class="spinner"></span>Eredmények mentése...';

  fetch("https://brand-quiz-proxy.vercel.app/api/quiz-proxy", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ email: email, name: name, results: archetypes })
  })
  .then(res => res.text())
  .then(text => {
    console.log("Válasz a szervertől:", text);
    statusEl.textContent = "Az eredményeket elmentettük. Köszönjük a kitöltést!";
    btn.textContent = "Elküldve";
  })
  .catch(err => {
    console.error(err);
    statusEl.textContent = "Hiba történt a mentés során. Kérjük, próbáld meg később újra.";
    btn.disabled = false;
    btn.textContent = "Eredmény mentése";
    isSending = false;
  });
}
</script>
</body>
</html>
